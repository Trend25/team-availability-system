<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>TeamAVAS</title>
<style>
body { font-family: Segoe UI, Arial; background:#0f172a; color:#e2e8f0; margin:0; padding:0; }
.container{max-width:1000px;margin:20px auto;background:#111827;border:1px solid #374151;border-radius:12px;overflow:hidden;padding:20px;}
.tab{padding:10px 16px;background:#1e293b;border:none;color:#cbd5e1;cursor:pointer}
.tab.active{background:#334155;color:#fff}
.tab-content{display:none}
.section{background:#0b1020;border:1px solid #26324d;border-radius:10px;padding:12px;margin-bottom:14px}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:8px}
.cal-day{background:#1e293b;border-radius:8px;padding:8px;text-align:center;cursor:pointer}
.cal-day.selected{outline:2px solid #60a5fa}
.cal-day.weekend{opacity:.5}
.msg{padding:10px;border-radius:8px;margin-top:8px;font-weight:600}
.msg.success{background:#064e3b;color:#d1fae5}
.msg.error{background:#5b1a1a;color:#fee2e2}
.btn{background:#3b82f6;border:none;color:#fff;font-weight:700;padding:10px 14px;border-radius:10px;cursor:pointer}
.btn:active{transform:translateY(1px)}
</style>
</head>
<body>
<div class="container">
<h2>TeamAVAS</h2>
<p>Status-based Availability System</p>

<div class="section">
<label>Status:
<select id="avail-status" onchange="toggleTimeInputs()">
  <option value="yes">Available</option>
  <option value="no">Not Available</option>
  <option value="clear">Clear (remove)</option>
</select>
</label>
</div>

<div class="section">
  <div id="my-calendar">Takvim y√ºkleniyor...</div>
  <button class="btn" onclick="saveMyAvailability()">Save for selected days</button>
  <div id="avail-msg"></div>
</div>
</div>

<script>
/* --- Local date helper (prevents UTC shift) --- */
function localDateStr(date){
  const y = date.getFullYear();
  const m = String(date.getMonth()+1).padStart(2,'0');
  const d = String(date.getDate()).padStart(2,'0');
  return `${y}-${m}-${d}`;
}

let DB={availability:{}};
let ME={id:'me'};
let SELECTED_DAYS=new Set();
let START_TIME='09:00';
let END_TIME='17:00';

function toggleTimeInputs(){}
function showMsg(id,txt,type){document.getElementById(id).innerHTML=`<div class="msg ${type}">${txt}</div>`;setTimeout(()=>{document.getElementById(id).innerHTML='';},3000)}
function setStatus(){}
async function loadDB(){DB=JSON.parse(localStorage.getItem('teamavas-db')||'{"availability":{}}');}
async function saveDB(){localStorage.setItem('teamavas-db',JSON.stringify(DB));}

function toggleDaySelection(dateStr,isWeekend){
  if(isWeekend)return;
  const cell=document.querySelector(`.cal-day[data-date="${dateStr}"]`);
  if(!cell)return;
  if(SELECTED_DAYS.has(dateStr)){SELECTED_DAYS.delete(dateStr);cell.classList.remove('selected');}
  else{SELECTED_DAYS.add(dateStr);cell.classList.add('selected');}
}

async function renderMyCalendar(){
  await loadDB();
  const now=new Date();
  const year=now.getFullYear(),month=now.getMonth();
  const first=new Date(year,month,1),last=new Date(year,month+1,0);
  const days=last.getDate(),offset=(first.getDay()+6)%7;
  const myAvail=DB.availability[ME.id]||{};
  let html='<div class="cal-grid">';
  const labels=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  labels.forEach(d=>html+=`<div><b>${d}</b></div>`);
  for(let i=0;i<offset;i++)html+='<div></div>';
  for(let d=1;d<=days;d++){
    const date=new Date(year,month,d);
    const dow=date.getDay();
    const isWeekend=(dow===0||dow===6);
    const dateStr=localDateStr(date);
    let cls='cal-day'+(isWeekend?' weekend':'');
    let extra='';
    const av=myAvail[dateStr];
    if(av){
      cls+=' selected';
      const s=av.startUTC?new Date(av.startUTC).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}):(av.start||'');
      const e=av.endUTC?new Date(av.endUTC).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}):(av.end||'');
      extra=av.status==='yes'?`<small>${s}-${e}</small>`:'<small>Not Available</small>';
    }
    html+=`<div class="${cls}" data-date="${dateStr}" onclick="toggleDaySelection('${dateStr}',${isWeekend})">${d}${extra}</div>`;
  }
  html+='</div>';
  document.getElementById('my-calendar').innerHTML=html;
}

async function saveMyAvailability(){
  if(SELECTED_DAYS.size===0){showMsg('avail-msg','Select at least one day','error');return;}
  await loadDB();
  const status=document.getElementById('avail-status').value;
  if(!DB.availability[ME.id])DB.availability[ME.id]={};

  SELECTED_DAYS.forEach(dateStr=>{
    const dateKey=dateStr;
    if(status==='clear'){
      delete DB.availability[ME.id][dateKey];
      return;
    }
    const startLocal=new Date(`${dateStr}T${START_TIME}:00`);
    const endLocal=new Date(`${dateStr}T${END_TIME}:00`);
    DB.availability[ME.id][dateKey]={
      status,
      start:status==='yes'?START_TIME:null,
      end:status==='yes'?END_TIME:null,
      startUTC:status==='yes'?startLocal.toISOString():null,
      endUTC:status==='yes'?endLocal.toISOString():null
    };
  });

  try{
    await saveDB();
    showMsg('avail-msg',`Saved ${SELECTED_DAYS.size} days!`,'success');
    SELECTED_DAYS.clear();
    renderMyCalendar();
  }catch(e){
    showMsg('avail-msg','Error: '+e.message,'error');
  }
}

window.onload=()=>{renderMyCalendar();}
</script>
</body>
</html>
